


<!--
Если открываете этот файл у себя на компьютере:
Рекомендую установить Markdown Viewer: https://chromewebstore.google.com/detail/markdown-viewer/ckkdlimhmcjmikdlpkmbgfkaikojcbjk
И далее открывать .md файлы браузером: ПКМ на любой .md файл в папке >> Свойства >> Изменить... (ассоциированную программу)
-->

## Что это?

Данная программа рисует [Mandelbrot Set](https://en.wikipedia.org/wiki/Mandelbrot_set) (Мно́жество Мандельбро́та)

Основной файл для запуска: `0Mandelbrot.pas`  
Его заранее откомпилированную версию можно скачать [тут](https://github.com/SunSerega/temp-Mandelbrot-example/releases/tag/latest-exe-tag).

Но рекомендую сначала скачать весь репозиторий и посмотреть в файл `Settings.pas`.  
Особенно на секцию для `VRAM`, `RAM` и `Drive` памяти.  
И затем запускать `0Mandelbrot.pas` чтобы применить изменения.

Первая компиляция будет очень медленной, потому что создаются огромные .pcu файлы. Пока компилирует - IDE может зависнуть.  
Поэтому рекомендую перед ней в папке нажать ПКМ на `OpenGLABC.pas` и выбрать "Компилировать". И параллельно так же на `OpenCLABC.pas`.  
Это создаст все .pcu файлы заранее, и сделает их Release-версию (она немного быстрее)  
Когда все 4 .pcu файла создало - можно компилировать основную программу.

---

## Управление

- Escape:      Завершение программы (дважды или +Ctrl чтобы отменить сохранение)
- Mouse Drag:  Быстрое движение камеры
- Arrows:      Гладкое движение камеры
- Scroll:      Быстрое изменение масштаба
- "+" и "-":   Гладкое изменение масштаба
- Space:       Сбросить положение камеры
- Ctrl+C:      Скопировать положение камеры (+Shift чтобы добавить комментарий)
- Ctrl+V:      Вставить положение камеры
- Win+V:       Вставить положение камеры из истории буфера обмена
- Q:           Сбросить визуальную информацию предыдущих кадров
- I:           Окно с доп. информацией о сцене

---

## В кратце про этот "Mandelbrot Set"

Есть рекуррентная функция `z_next(z) = z^2 + c`, то есть:

- `z0 = c`
- `z1 = z0^2 + c`
- `z2 = z1^2 + c`

и т.д.

Переменная `c` в этой функции - комплексное число `x + y*i`,
где `x` и `y` это координаты в пространстве.  
Эта переменная устанавливается в начале функции и дальше не меняется.

По теории уже доказано что если `|z|` (расстояние от центра координат) оказывается `>2`,
то далее расстояние от центра будет увеличиваться с каждым шагом (с каждой итерацией функции).

Но так же есть точки `c`, для которых `z` никогда не улетает в бесконечность.  
Такие точки как раз входят в так-называемое "Множество (точек) Мандельброта".

А рисуют обычно точки `c` для каждого писеля, которые таки улетели в бесконечность.  
Точнее, цвет выбирают исходя из того - сколько шагов успели посчитать до `|z|>2`

В данной программе:
- Если после всех шагов всё ещё `|z|<=2`, то цвет белый (чтобы не мигало пока продолжает считать)
- Если 0 успешных шагов (т.е. уже `|c|>2`), то цвет чёрный (сливается с фоном)
- В остальных случаях цвет радужный, в зависимости от кол-ва шагов

(можно менять в `Shaders\Rainbow.frag`)

Большинство подобных программ заранее выбирают максимальное кол-во шагов функции.  
Но в данной программе использован другой подход: Чем дольше подождёте - тем больше нарисует.  
Другими словами, максимальное количество шагов и точность вычислений изменяются на-ходу.

К примеру, рекомендую скопировать и вставить в программу (Ctrl+V) это:
```
c=цветениее
pos.r=-001.0000000001011001010100101010|00001010111000001011111110001100
pos.i=+000.0100000000000000100011001100|11100001101100110111110010100100
scale=1.807566*2^-17
```
(два "е" в конце комментария это не описка, а чтобы TTS произносил правильно)

---

## `MandelbrotSampling.cl`

В этом файле находятся основная часть кода для GPU, считающего рекуррентную функцию.  
Чтобы тестировать его поведение написаны вспомогательные программы:

- `SamplingTests.pas`: Тесты отдельных функций
- `FieldTest.pas`: Тест всего и сразу, с ограниченным кол-вом шагов и простейшим рендерингом в файл.


